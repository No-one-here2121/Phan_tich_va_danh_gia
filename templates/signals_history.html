{% extends "base.html" %}

{% block title %}{{ symbol }} - L·ªãch s·ª≠ T√≠n hi·ªáu Giao d·ªãch{% endblock %}

{% block content %}
<div class="container results-container">
    <!-- Header -->
    <div class="company-header">
        <div class="back-button">
            <a href="/" class="btn-back">
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Quay l·∫°i
            </a>
        </div>
        <div class="company-title-section">
            <h1 class="company-symbol">{{ symbol }}</h1>
            <h2 class="company-name">{{ company_name }}</h2>
        </div>
    </div>

    <!-- Signals History Table -->
    <div class="chart-section">
        <h2 class="section-title">üìä L·ªãch s·ª≠ T√≠n hi·ªáu (30 ng√†y g·∫ßn nh·∫•t)</h2>
        
        {% if signals_history %}
        <div class="table-container">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Ng√†y</th>
                        <th>T√≠n hi·ªáu Ch√≠nh</th>
                        <th>ƒê·ªô tin c·∫≠y</th>
                        <th>SMA</th>
                        <th>RSI</th>
                        <th>MACD</th>
                        <th>Bollinger Bands</th>
                        <th>Gi√°</th>
                    </tr>
                </thead>
                <tbody>
                    {% for signal in signals_history %}
                    <tr>
                        <td class="date-cell">{{ signal.signal_date }}</td>
                        <td>
                            <span class="signal-badge {% if signal.final_signal == 'BUY' %}badge-buy{% elif signal.final_signal == 'SELL' %}badge-sell{% else %}badge-hold{% endif %}">
                                {{ signal.final_signal }}
                            </span>
                        </td>
                        <td class="confidence-cell">{{ "{:.0%}".format(signal.final_confidence) }}</td>
                        <td>
                            {% if signal.sma_signal %}
                            <span class="mini-badge {% if signal.sma_signal == 'BUY' %}badge-buy{% elif signal.sma_signal == 'SELL' %}badge-sell{% else %}badge-hold{% endif %}">
                                {{ signal.sma_signal }}
                            </span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if signal.rsi_signal %}
                            <span class="mini-badge {% if signal.rsi_signal == 'BUY' %}badge-buy{% elif signal.rsi_signal == 'SELL' %}badge-sell{% else %}badge-hold{% endif %}">
                                {{ signal.rsi_signal }}
                            </span>
                            {% if signal.rsi_value %}
                            <br><small class="text-muted">{{ "{:.1f}".format(signal.rsi_value) }}</small>
                            {% endif %}
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if signal.macd_signal %}
                            <span class="mini-badge {% if signal.macd_signal == 'BUY' %}badge-buy{% elif signal.macd_signal == 'SELL' %}badge-sell{% else %}badge-hold{% endif %}">
                                {{ signal.macd_signal }}
                            </span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if signal.bb_signal %}
                            <span class="mini-badge {% if signal.bb_signal == 'BUY' %}badge-buy{% elif signal.bb_signal == 'SELL' %}badge-sell{% else %}badge-hold{% endif %}">
                                {{ signal.bb_signal }}
                            </span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if signal.sma_price %}
                            {{ "{:,.0f}".format(signal.sma_price) }}
                            {% else %}
                            -
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <strong>‚ÑπÔ∏è Kh√¥ng c√≥ d·ªØ li·ªáu</strong> - Ch∆∞a c√≥ t√≠n hi·ªáu giao d·ªãch ƒë∆∞·ª£c l∆∞u cho m√£ n√†y. 
            <a href="/analyze?symbol={{ symbol }}">Ph√¢n t√≠ch c·ªï phi·∫øu</a>
        </div>
        {% endif %}
    </div>

    <!-- Signal Explanation -->
    <div class="chart-section info-section">
        <h2 class="section-title">üìñ H∆∞·ªõng d·∫´n ƒë·ªçc T√≠n hi·ªáu</h2>
        <div class="explanation-grid">
            <div class="explanation-card">
                <div class="card-header">üü¢ BUY (Mua)</div>
                <div class="card-body">D·∫•u hi·ªáu bullish, khuy·∫øn ngh·ªã mua ho·∫∑c tƒÉng v·ªã th·∫ø</div>
            </div>
            <div class="explanation-card">
                <div class="card-header">üî¥ SELL (B√°n)</div>
                <div class="card-body">D·∫•u hi·ªáu bearish, khuy·∫øn ngh·ªã b√°n ho·∫∑c gi·∫£m v·ªã th·∫ø</div>
            </div>
            <div class="explanation-card">
                <div class="card-header">üü† HOLD (Gi·ªØ)</div>
                <div class="card-body">T√≠n hi·ªáu trung l·∫≠p, khuy·∫øn ngh·ªã ch·ªù ho·∫∑c gi·ªØ v·ªã th·∫ø</div>
            </div>
            <div class="explanation-card">
                <div class="card-header">üìä SMA Crossover</div>
                <div class="card-body">Giao c·∫Øt gi·ªØa c√°c ƒë∆∞·ªùng trung b√¨nh ƒë·ªông 20, 50, 200</div>
            </div>
            <div class="explanation-card">
                <div class="card-header">üìà RSI</div>
                <div class="card-body">Ch·ªâ s·ªë ƒë·ªô m·∫°nh t∆∞∆°ng ƒë·ªëi: < 30 qu√° b√°n, > 70 qu√° mua</div>
            </div>
            <div class="explanation-card">
                <div class="card-header">üîÑ MACD</div>
                <div class="card-body">S·ª± h·ªôi t·ª•/ph√¢n k·ª≥ trung b√¨nh ƒë·ªông: Giao c·∫Øt c·ªßa MACD v√† Signal</div>
            </div>
        </div>
    </div>
</div>

<style>
.explanation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.explanation-card {
    background: white;
    border-radius: 10px;
    padding: 20px;
    border: 2px solid var(--border);
    transition: all 0.3s ease;
}

.explanation-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-lg);
}

.card-header {
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 10px;
    color: var(--dark);
}

.card-body {
    font-size: 14px;
    color: var(--gray);
    line-height: 1.6;
}

.mini-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 15px;
    font-size: 11px;
    font-weight: 600;
}

.text-muted {
    color: var(--gray);
}

.date-cell {
    font-weight: 500;
}

.confidence-cell {
    font-weight: 600;
    color: var(--primary);
}
</style>
{% endblock %}
