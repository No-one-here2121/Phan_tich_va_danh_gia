<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Ph√¢n t√≠ch C·ªï phi·∫øu Vi·ªát Nam{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <h1>üìä Stock Analyzer</h1>
            </div>
            <div class="nav-links">
                <a href="{{ url_for('index') }}" class="nav-link">Trang ch·ªß</a>
                {% if username %}
                <div class="user-panel" style="display: inline-block; margin-left: 20px;">
                    <span style="color: #fff; margin-right: 10px;">Xin ch√†o, <strong>{{ username }}</strong>!</span>
                    <a href="{{ url_for('logout') }}" class="nav-link" style="color: #ff6b6b; font-weight: 500;">ƒêƒÉng
                        xu·∫•t</a>
                </div>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">ƒêang t·∫£i d·ªØ li·ªáu...</div>
            <div class="loading-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
    </div>

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 Stock Analysis Tool | Ngu·ªìn d·ªØ li·ªáu: VCI</p>
        </div>
    </footer>

    <script>
        // Loading animation management
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingText = document.getElementById('loadingText');
        const progressFill = document.getElementById('progressFill');

        const loadingMessages = [
            'ƒêang k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß...',
            'ƒêang t·∫£i th√¥ng tin c√¥ng ty...',
            'ƒêang l·∫•y d·ªØ li·ªáu l·ªãch s·ª≠ gi√°...',
            'ƒêang t√≠nh to√°n c√°c ch·ªâ s·ªë t√†i ch√≠nh...',
            'ƒêang ph√¢n t√≠ch theo ng√†nh...',
            'ƒêang t·∫°o bi·ªÉu ƒë·ªì...',
            'Ho√†n t·∫•t! ƒêang hi·ªÉn th·ªã k·∫øt qu·∫£...'
        ];

        let messageIndex = 0;
        let progressInterval;
        let messageInterval;

        function showLoading() {
            loadingOverlay.classList.add('active');
            messageIndex = 0;
            let progress = 0;

            // Update progress bar
            progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 95) progress = 95;
                progressFill.style.width = progress + '%';
            }, 800);

            // Cycle through messages
            messageInterval = setInterval(() => {
                messageIndex = (messageIndex + 1) % loadingMessages.length;
                loadingText.textContent = loadingMessages[messageIndex];
            }, 2000);
        }

        function hideLoading() {
            clearInterval(progressInterval);
            clearInterval(messageInterval);
            progressFill.style.width = '100%';
            loadingText.textContent = 'Ho√†n t·∫•t!';

            setTimeout(() => {
                loadingOverlay.classList.remove('active');
                progressFill.style.width = '0%';
            }, 500);
        }

        // Attach to all forms that should show loading
        document.addEventListener('DOMContentLoaded', function () {
            const forms = document.querySelectorAll('form[action*="analyze"]');
            forms.forEach(form => {
                form.addEventListener('submit', function (e) {
                    const symbol = form.querySelector('input[name="symbol"]');
                    if (symbol && symbol.value.trim()) {
                        showLoading();
                    }
                });
            });
        });

        // Hide loading when page loads (in case of back button or error)
        window.addEventListener('load', function () {
            hideLoading();
        });
    </script>
</body>

</html>